// prisma/schema.prisma
generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
  schemas  = ["public"]
}

model User {
  id             String   @id @default(uuid())          
  email          String   @unique @db.Citext
  email_verified Boolean  @default(false)
  created_at     DateTime @default(now()) @db.Timestamptz(6)
  last_login     DateTime? @db.Timestamptz(6)

  consent_privacy         Boolean     @default(false)
  consent_privacy_at      DateTime?
  consent_privacy_version Int?

  sessions       Session[]
  lifestyleSurvey LifestyleSurvey?   // 1:1 관계 역방향
  @@schema("public")


  
}

model Session {
  id             String   @id @default(uuid())          
  user_id        String                                  
  session_token  String   @unique
  created_at     DateTime @default(now()) @db.Timestamptz(6)
  expires_at     DateTime @db.Timestamptz(6)
  ip             String?
  user_agent     String?
  user           User     @relation(fields: [user_id], references: [id], onDelete: Cascade)
  @@index([user_id, expires_at], map: "idx_sessions_user_expires")

  @@schema("public")

}


model VerificationCode {
  id           String    @id @default(uuid())
  email        String    @db.VarChar(255)
  code_hash    String    @db.VarChar(255)
  expires_at   DateTime
  consumed_at  DateTime?
  attempts     Int       @default(0)
  created_at   DateTime  @default(now())

  @@index([email, expires_at])
  @@schema("public")
  @@map("VerificationCode")
}

enum Gender {
  MALE
  FEMALE

  @@schema("public")
}

enum ShowerFreq {
  ONCE
  TWICE
  TWO_DAYS
  RARE

  @@schema("public")
}

enum CleaningFreq {
  ONCE
  TWICE
  TWO_DAYS
  RARE

  @@schema("public")
}

enum ActivityLevel {
  SMOKER
  NON_SMOKER

  @@schema("public")
}

enum OutgoingFreq {
  EVERY_WEEK
  TWO_WEEKS
  WEEKENDS
  VACATION

  @@schema("public")
}

enum MealPlace {
  DORM
  OUTSIDE

  @@schema("public")
}

enum GamingTime {
  NONE
  ONE_MINUS
  ONE_TO_THREE
  THREE_PLUS

  @@schema("public")
}

enum DrinkFreq {
  NONE
  RARE
  ONE_TWO
  THREE_PLUS

  @@schema("public")
}

enum EI {
  E
  I

  @@schema("public")
}

enum NS {
  N
  S

  @@schema("public")
}

enum TF {
  T
  F

  @@schema("public")
}

enum JP {
  J
  P

  @@schema("public")
}


model LifestyleSurvey {
  id              String   @id @default(uuid())
  userId          String   @unique
  user            User     @relation(fields: [userId], references: [id])

  age             Int
  department      String
  gender          Gender

  // MBTI 분리
  mbti1           EI
  mbti2           NS
  mbti3           TF
  mbti4           JP

  // minutes
  wakeTimeMinutes Int
  sleepTimeMinutes Int

  showerFreq      ShowerFreq
  cleaningFreq    CleaningFreq

  activityLevel   ActivityLevel

  roomTraits      String[]    // 그대로 OK
  coldSensitivity Boolean
  hotSensitivity  Boolean

  outgoingFreq    OutgoingFreq
  mealPlace       MealPlace?
  mealNote        String?

  gamingTime      GamingTime
  drinkFreq       DrinkFreq

  homeStyle       String[]
  hobbies         String[]

  roommateWish    String
  selfTags        String[]

  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  @@schema("public")
}
